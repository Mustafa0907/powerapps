Screen5_1 As screen:
    ContentLanguage: =""

    Container6_5 As groupContainer.manualLayoutContainer:
        DropShadow: =DropShadow.None
        Fill: =RGBA(250, 247, 255, 1)
        Height: =850
        PaddingLeft: =15
        PaddingRight: =15
        Width: =1740
        X: =395
        Y: =150
        ZIndex: =1

        Label2_50 As label:
            Align: =Align.Center
            Color: =RGBA(106, 108, 125, 1)
            FontWeight: =FontWeight.Semibold
            PaddingLeft: =10
            PaddingRight: =9.10
            Size: =15
            Text: ="Item Name"
            Width: =273
            X: =40
            Y: =108
            ZIndex: =1

        Gallery6_1 As gallery.galleryVertical:
            '#CopilotOverlayLabel': ="Filtered"
            DelayItemLoading: =true
            Height: =463
            Items: =PurchaseOrderCollection
            Layout: =Layout.Vertical
            LoadingSpinner: =LoadingSpinner.Data
            TemplatePadding: =15
            TemplateSize: =41
            Transition: =""
            Width: =1732
            X: =8
            Y: =165
            ZIndex: =1

            Button6_1 As button:
                BorderThickness: =0
                DisabledFill: =RGBA(255, 255, 255, 1)
                DisplayMode: =DisplayMode.Disabled
                Fill: =RGBA(255, 255, 255, 1)
                OnSelect: =Select(Parent)
                RadiusBottomLeft: =15
                RadiusBottomRight: =15
                RadiusTopLeft: =15
                RadiusTopRight: =15
                Text: =""
                Width: =1684
                X: =2
                ZIndex: =1

            Icon1_2 As icon.Trash:
                Color: =RGBA(215, 58, 60, 1)
                Height: =19
                Icon: =Icon.Trash
                OnSelect: =Remove(PurchaseOrderCollection, ThisItem)
                Width: =20
                X: =1655
                Y: =10
                ZIndex: =9

            Dropdown2 As dropdown:
                Default: =
                Items: =Filter(Products, IsDeleted = false)
                OnChange: |-
                    =
                    Set(varUnit, Filter(Products, Name = Dropdown2.Selected.Title, Unit.Value ))
                OnSelect: =Select(Parent)
                SelectionFill: =RGBA(109, 49, 162, 1)
                Width: =253
                X: =31
                ZIndex: =11

            Label7 As label:
                Align: =Align.Center
                BorderThickness: =2
                Color: =RGBA(106, 108, 125, 1)
                FontWeight: =FontWeight.Bold
                OnSelect: =Select(Parent)
                Text: |
                    =LookUp(
                        Inventories,
                        ProductID.Id = LookUp(
                            Products,
                            SKU = ComboBox1.Selected.SKU).ID).ID
                Visible: =false
                X: =415
                ZIndex: =12

            TextInput1 As text:
                Color: =RGBA(106, 108, 125, 1)
                Default: =0
                FontWeight: =FontWeight.Bold
                Format: =TextFormat.Number
                OnSelect: =Select(Parent)
                Width: =193
                X: =491
                ZIndex: =13

            Label7_1 As label:
                Align: =Align.Center
                Color: =RGBA(106, 108, 125, 1)
                FontWeight: =FontWeight.Bold
                Height: =41
                OnSelect: =Select(Parent)
                Text: ="$"
                Width: =28
                X: =463
                ZIndex: =14

            TextInput1_1 As text:
                Color: =RGBA(106, 108, 125, 1)
                Default: =0
                FontWeight: =FontWeight.Bold
                Format: =TextFormat.Number
                Height: =41
                OnSelect: =Select(Parent)
                Width: =198
                X: =858
                ZIndex: =15

            Label7_2 As label:
                Align: =Align.Center
                Color: =RGBA(106, 108, 125, 1)
                FontWeight: =FontWeight.Bold
                Height: =41
                OnSelect: =Select(Parent)
                Text: ="$"
                Width: =28
                X: =830
                ZIndex: =16

            TextInput1_3 As text:
                Color: =RGBA(106, 108, 125, 1)
                Default: =""
                FontWeight: =FontWeight.Bold
                Format: =TextFormat.Number
                Height: =41
                OnChange: =
                OnSelect: =Select(Parent)
                Width: =174
                X: =1180
                ZIndex: =18

            TextInput1_4 As text:
                Color: =RGBA(106, 108, 125, 1)
                Default: =ThisItem.Quantity * ThisItem.CostPrice
                FontWeight: =FontWeight.Bold
                Format: =TextFormat.Number
                OnSelect: =Select(Parent)
                Visible: =false
                Width: =173
                X: =1180
                Y: =1
                ZIndex: =19

            Label7_3 As label:
                Align: =Align.Center
                BorderThickness: =2
                Color: =RGBA(106, 108, 125, 1)
                DisabledColor: =RGBA(106, 108, 125, 1)
                DisplayMode: =DisplayMode.Disabled
                FontWeight: =FontWeight.Bold
                OnSelect: =Select(Parent)
                Text: =TextInput1.Text * TextInput1_3.Text
                Width: =121
                X: =1492
                ZIndex: =20

            Label7_4 As label:
                Align: =Align.Center
                Color: =RGBA(106, 108, 125, 1)
                FontWeight: =FontWeight.Bold
                Height: =41
                OnSelect: =Select(Parent)
                Text: ="$"
                Width: =28
                X: =1464
                ZIndex: =21

            ComboBox1 As combobox:
                DisplayFields: =["SKU"]
                InputTextPlaceholder: ="Find items"
                Items: =Filter(Products, IsDeleted = false)
                OnChange: =Set(varUnit, Filter(Products, Name = Dropdown2.Selected.Title, Unit.Value ))
                OnSelect: =Select(Parent)
                SearchFields: =["SKU"]
                SearchItems: =Search(Filter(Products, IsDeleted = false),ComboBox1.SearchText,SKU)
                SelectMultiple: =false
                Width: =253
                X: =31
                ZIndex: =22

        Label2_51 As label:
            Align: =Align.Center
            Color: =RGBA(106, 108, 125, 1)
            FontWeight: =FontWeight.Semibold
            PaddingLeft: =10
            PaddingRight: =9.10
            Size: =15
            Text: ="Inventory ID"
            Visible: =false
            Width: =282
            X: =368
            Y: =112
            ZIndex: =2

        Label2_52 As label:
            Align: =Align.Center
            Color: =RGBA(106, 108, 125, 1)
            FontWeight: =FontWeight.Semibold
            PaddingLeft: =10
            PaddingRight: =9.10
            Size: =15
            Text: ="Cost Price"
            Width: =262
            X: =466
            Y: =108
            ZIndex: =3

        Label2_53 As label:
            Align: =Align.Center
            Color: =RGBA(106, 108, 125, 1)
            FontWeight: =FontWeight.Semibold
            PaddingLeft: =10
            PaddingRight: =9.10
            Size: =15
            Text: ="Sale Price"
            Width: =276
            X: =823
            Y: =108
            ZIndex: =4

        Label2_55 As label:
            Align: =Align.Center
            Color: =RGBA(106, 108, 125, 1)
            FontWeight: =FontWeight.Semibold
            PaddingLeft: =10
            PaddingRight: =9.10
            Size: =15
            Text: ="Price per Unit"
            Visible: =false
            Width: =276
            X: =1224
            Y: =110
            ZIndex: =6

        Label2_56 As label:
            Align: =Align.Center
            Color: =RGBA(106, 108, 125, 1)
            FontWeight: =FontWeight.Semibold
            PaddingLeft: =10
            PaddingRight: =9.10
            Size: =15
            Text: ="Total"
            Width: =234.52
            X: =1456
            Y: =108
            ZIndex: =7

        Label2_49 As label:
            AutoHeight: =true
            Color: =RGBA(106, 108, 125, 1)
            FontWeight: =FontWeight.Bold
            Height: =50
            Size: =22
            Text: ="Create a Purchase Order"
            Width: =419
            X: =40
            Y: =40
            ZIndex: =8

        Button5_1 As button:
            BorderThickness: =0
            Fill: =RGBA(40, 134, 222, 1)
            OnSelect: |-
                =Collect(PurchaseOrderCollection, {InventoryID: 0, ItemName: "", CostPrice: 0, RetailPrice: 0, Units: "", Quantity: 0, Total: 0})
            RadiusBottomLeft: =15
            RadiusBottomRight: =15
            RadiusTopLeft: =15
            RadiusTopRight: =15
            Text: ="+ New"
            Width: =200
            X: =1470
            Y: =43
            ZIndex: =9

        Label2_64 As label:
            Align: =Align.Center
            Color: =RGBA(106, 108, 125, 1)
            FontWeight: =FontWeight.Semibold
            Height: =38
            PaddingLeft: =10
            PaddingRight: =9.10
            Size: =15
            Text: ="Qty"
            Width: =194
            X: =1196
            Y: =114
            ZIndex: =10

        Button5_2 As button:
            BorderThickness: =0
            Fill: =RGBA(40, 134, 222, 1)
            OnSelect: |-
                =Set(varNewPO, Patch(PurchaseOrder, Defaults(PurchaseOrder), {TotalPrice: Value(Label2_58.Text)}));
                
                // Iterate over items in Gallery6_1 to manage inventory
                ForAll(
                    Gallery6_1.AllItems,
                    // Determine if an existing inventory matches the current item's ID and cost price
                        With(
                            {existingInventory: LookUp(Inventories, ProductID.Id = LookUp(Products, SKU = ComboBox1.Selected.SKU).ID && CostPrice = Int(TextInput1.Text))},
                            // Check if existing inventory was found
                            
                            If(
                                IsBlank(existingInventory),
                                // Create new inventory item
                                With(
                                    {
                                        newInventory: Patch(
                                            Inventories,
                                            Defaults(Inventories),
                                            {
                                                ProductID: 
                                                {
                                                    '@odata.type': "#Microsoft.Azure.Connectors.SharePoint.SPListExpandedReference",
                                                    Id:  Int(LookUp(Products, SKU = ComboBox1.Selected.SKU).ID),
                                                    Value: LookUp(Products, SKU = ComboBox1.Selected.SKU).Title
                                                }, // Assuming ProductID expects the ID directly
                                                CostPrice: Int(TextInput1.Text),
                                                QuantityAvailable: Int(TextInput1_3.Text),
                                                RetailPrice: Int(TextInput1_1.Text)
                                                
                                            }
                                        )
                                    },
                                    // Use new inventory item's ID in PurchaseOrderDetail
                                    Patch(
                                        PurchaseOrderDetail,
                                        Defaults(PurchaseOrderDetail),
                                        {
                                            PurchaseOrderID: {
                                                '@odata.type': "#Microsoft.Azure.Connectors.SharePoint.SPListExpandedReference",
                                                Id: varNewPO.ID,
                                                Value: varNewPO.Title
                                            },
                                            Quantity: Int(TextInput1_3.Text),
                                            InventoryID: {
                                                '@odata.type': "#Microsoft.Azure.Connectors.SharePoint.SPListExpandedReference",
                                                Id: Int(newInventory.ID),
                                                Value:  newInventory.ID
                                            }
                                        }
                                    )
                                ),
                                With(
                                    {
                                        updatedInventory: Patch(
                                            Inventories,{
                                                ID:existingInventory.ID
                                            },
                                            {QuantityAvailable: existingInventory.QuantityAvailable + Int(TextInput1_3.Text)}
                                        )
                                    },
                                    Patch(
                                        PurchaseOrderDetail,
                                        Defaults(PurchaseOrderDetail),
                                        {
                                            PurchaseOrderID: {
                                                '@odata.type': "#Microsoft.Azure.Connectors.SharePoint.SPListExpandedReference",
                                                Id: varNewPO.ID,
                                                Value: varNewPO.Title
                                            },
                                            Quantity: Int(TextInput1_3.Text),
                                            InventoryID: {
                                                '@odata.type': "#Microsoft.Azure.Connectors.SharePoint.SPListExpandedReference",
                                                Id: Int(existingInventory.ID),
                                                Value:  existingInventory.ID
                                            }
                                        }
                                    )
                                )
                
                            )
                        )
                );
                Navigate(Screen5);
            RadiusBottomLeft: =15
            RadiusBottomRight: =15
            RadiusTopLeft: =15
            RadiusTopRight: =15
            Text: ="Create"
            Width: =200
            X: =1464
            Y: =742
            ZIndex: =11

        Label2_57 As label:
            Align: =Align.Right
            Color: =RGBA(106, 108, 125, 1)
            FontWeight: =FontWeight.Semibold
            PaddingLeft: =10
            PaddingRight: =9.10
            Size: =15
            Text: |-
                ="Total Price:
                "
            Width: =276
            X: =1314
            Y: =665
            ZIndex: =12

        Label2_58 As label:
            Color: =RGBA(106, 108, 125, 1)
            FontWeight: =FontWeight.Semibold
            PaddingLeft: =10
            PaddingRight: =9.10
            Size: =15
            Text: =Sum(Gallery6_1.AllItems,Label7_3.Text)
            Width: =100
            X: =1590
            Y: =665
            ZIndex: =13

        Button5_11 As button:
            BorderThickness: =0
            Fill: =RGBA(224, 224, 224, 1)
            HoverFill: =ColorFade(Self.Fill, -20%)
            OnSelect: =Navigate(Screen5_5);
            RadiusBottomLeft: =15
            RadiusBottomRight: =15
            RadiusTopLeft: =15
            RadiusTopRight: =15
            Text: ="Cancel"
            Width: =200
            X: =76
            Y: =742
            ZIndex: =14

    Container6_4 As groupContainer.manualLayoutContainer:
        DropShadow: =DropShadow.None
        Fill: =RGBA(250, 247, 255, 1)
        Height: =850
        PaddingLeft: =15
        PaddingRight: =15
        Width: =350
        X: =15
        Y: =150
        ZIndex: =2

        "Sidebar_4 As 'Admin Sidebar'":
            NavigateToOh: =Screen5_5
            NavigateToPo: =Screen5_1
            NavigateToProducts: =Screen5
            NavigateToSo: =Screen5_2
            ZIndex: =6

        "'Consumer Sidebar_4' As 'Consumer Sidebar'":
            NavigateToOh: =Screen5_5
            NavigateToProducts: =Screen5
            NavigateToSo: =Screen5_2
            Visible: =If(varRole = "Consumer", true, false)
            ZIndex: =7

        "'IM Sidebar_4' As 'IM Sidebar'":
            NavigateToOh: =Screen5_5
            NavigateToPo: =Screen5_1
            NavigateToProducts: =Screen5
            Visible: =If(varRole = "Inventory Manager1" || varRole = "Inventory Manager2", true, false)
            ZIndex: =8

    Container6_3 As groupContainer.manualLayoutContainer:
        DropShadow: =DropShadow.None
        Fill: =RGBA(250, 247, 255, 1)
        Height: =112
        PaddingLeft: =15
        PaddingRight: =15
        Width: =2120
        X: =15
        Y: =20
        ZIndex: =3

        Label3_4 As label:
            Align: =Align.Center
            BorderStyle: =BorderStyle.None
            Color: =RGBA(109, 49, 162, 1)
            Fill: =RGBA(250, 247, 255, 1)
            FontWeight: =FontWeight.Bold
            Height: =Parent.Height
            Italic: =true
            PaddingRight: =9.10
            PaddingTop: =9.10
            Size: =63.71
            Text: ="ims"
            Width: =228
            ZIndex: =1

        Label3_5 As label:
            Align: =Align.Center
            BorderStyle: =BorderStyle.None
            Color: =RGBA(109, 49, 162, 1)
            Fill: =RGBA(250, 247, 255, 1)
            FontWeight: =FontWeight.Bold
            Height: =112
            Italic: =true
            PaddingRight: =9.10
            Size: =63.71
            Text: ="Inventory Management System"
            Width: =1892
            X: =228
            ZIndex: =2

    Container6_24 As groupContainer.manualLayoutContainer:
        DropShadow: =DropShadow.None
        Fill: =RGBA(250, 247, 255, 1)
        Height: =850
        PaddingLeft: =15
        PaddingRight: =15
        RadiusBottomLeft: =10
        RadiusBottomRight: =10
        RadiusTopLeft: =10
        RadiusTopRight: =10
        Width: =350
        X: =15
        Y: =150
        ZIndex: =4

        Gallery8_2 As gallery.galleryVertical:
            '#CopilotOverlayLabel': ="Filtered"
            DelayItemLoading: =true
            Height: =740
            Items: =If(varRole = "Inventory Manager1" || varRole = "Inventory Manager2", Filter(SideBarGallery, Tab <> "Sale Orders"), If(varRole = "Consumer", Filter(SideBarGallery, Tab <> "Purchase Order"), SideBarGallery))
            Layout: =Layout.Vertical
            LoadingSpinner: =LoadingSpinner.Data
            TemplateSize: =66
            Width: =350
            Y: =95
            ZIndex: =2

            Button3_19 As button:
                BorderStyle: =BorderStyle.None
                Color: =RGBA(109, 49, 162, 1)
                Fill: =RGBA(255, 255, 255, 1)
                FontWeight: =FontWeight.Normal
                HoverColor: =ColorFade(Self.Fill, -20%)
                HoverFill: =ColorFade(Self.Color, -20%)
                OnSelect: |-
                    =If(ThisItem.Tab = "Inventory", Navigate(Screen5));
                    If(ThisItem.Tab = "Purchase Order", Navigate(Screen5_1));
                    If(ThisItem.Tab = "Sale Orders", Navigate(Screen5_2));
                    If(ThisItem.Tab = "Order History", Navigate(Screen5_5));
                RadiusBottomLeft: =0
                RadiusBottomRight: =0
                RadiusTopLeft: =0
                RadiusTopRight: =0
                Size: =18.21
                Text: =ThisItem.Tab
                Width: =339
                X: =0.00
                Y: =9
                ZIndex: =3

    Label12_12 As label:
        Color: =RGBA(109, 49, 162, 1)
        FontWeight: =FontWeight.Bold
        Height: =48
        Size: =17
        Text: =LookUp(Roles, Person.Email = User().Email).Title
        Width: =254
        X: =1866
        Y: =35
        ZIndex: =5

    Label12_13 As label:
        Color: =RGBA(109, 49, 162, 1)
        FontWeight: =FontWeight.Bold
        Height: =48
        Size: =17
        Text: =LookUp(Roles, Person.Email = User().Email).Role.Value
        Width: =254
        X: =1866
        Y: =68
        ZIndex: =6

