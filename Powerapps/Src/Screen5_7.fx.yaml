Screen5_7 As screen:

    Container6_39 As groupContainer.manualLayoutContainer:
        DropShadow: =DropShadow.None
        Fill: =RGBA(250, 247, 255, 1)
        Height: =850
        PaddingLeft: =15
        PaddingRight: =15
        Width: =1740
        X: =395
        Y: =150
        ZIndex: =1

        Gallery1_3 As gallery.galleryVertical:
            '#CopilotOverlayLabel': ="Filtered"
            DelayItemLoading: =true
            Height: =551
            Items: |+
                =/*If(
                    Not(IsBlank(varNewSO)),
                    Distinct(
                        Filter(
                            SalesOrderDetail, 
                            SalesOrderID.Id = varNewSO.ID
                        ), 
                        LookUp(Inventories, ID = InventoryID.Id).ProductID
                    ),
                    Blank()
                )*/
                AddColumns(
                    GroupBy(
                        SalesOrderItems, 
                        ProductID, 
                        ItemsByProduct
                    ),
                    FirstItem, First(ItemsByProduct)
                )
                
            Layout: =Layout.Vertical
            LoadingSpinner: =LoadingSpinner.Data
            TemplateSize: |
                =300
            X: =1076
            Y: =116
            ZIndex: =1

            Container12_3 As groupContainer.manualLayoutContainer:
                BorderThickness: =2
                Fill: =RGBA(255, 255, 255, 1)
                Height: =68
                RadiusBottomLeft: =10
                RadiusBottomRight: =10
                RadiusTopLeft: =10
                RadiusTopRight: =10
                Width: =554
                X: =40
                Y: =40
                ZIndex: =1

                Label8_3 As label:
                    FontWeight: =FontWeight.Bold
                    Height: =68
                    PaddingLeft: =30
                    Size: =16
                    Text: |
                        =//LookUp(Products, ID = LookUp(Inventories, ID = ThisItem.Value.Id).ProductID.Id).SKU
                        //LookUp(Products, ID = ThisItem.Value.Id).SKU
                        LookUp(Products, ID = LookUp(Inventories, ID = ThisItem.FirstItem.InventoryID).ProductID.Id).SKU
                    Width: =470
                    X: =9
                    ZIndex: =1

            Label9_10 As label:
                Align: =Align.Center
                FontWeight: =FontWeight.Bold
                OnSelect: =Select(Parent)
                Text: ="ID"
                X: =40
                Y: =124
                ZIndex: =2

            Label9_11 As label:
                Align: =Align.Center
                FontWeight: =FontWeight.Bold
                OnSelect: =Select(Parent)
                Text: ="Quantity"
                X: =174
                Y: =124
                ZIndex: =3

            Label9_12 As label:
                Align: =Align.Center
                FontWeight: =FontWeight.Bold
                OnSelect: =Select(Parent)
                Text: ="Unit Price"
                X: =336
                Y: =124
                ZIndex: =4

            Gallery7_3 As gallery.galleryVertical:
                '#CopilotOverlayLabel': ="Filtered"
                DelayItemLoading: =true
                Height: =109
                Items: |+
                    =//Filter(SalesOrderDetail, InventoryID.Id = LookUp(Inventories, ID = ThisItem.Value.Id).ID)
                    //Filter(Inventories,ID = Filter(SalesOrderDetail, SalesOrderID.Id = varNewSO.ID)
                    //varSalesOrderDetails
                    //Filter(SalesOrderDetail, SalesOrderID.Id = varNewSO.ID && LookUp(
                    /*If(
                        Not(IsBlank(varNewSO)),
                        Filter(SalesOrderDetail, SalesOrderID.Id = varNewSO.ID && LookUp(
                                Inventories, 
                                ID = InventoryID.Id
                            //).ProductID.Id = LookUp(Products, ID = LookUp(Inventories, ID = ThisItem.Value.Id).ProductID.Id).ID
                            ).ProductID.Id = LookUp(Products, ID = ThisItem.Value).ID
                        ),
                        Blank())*/
                    Filter(SalesOrderItems, ProductID = ThisItem.ProductID)
                    
                    
                    
                Layout: =Layout.Vertical
                LoadingSpinner: =LoadingSpinner.Data
                TemplateSize: =If(Self.Layout = Layout.Horizontal, Min(280, Self.Width - 60), Min(280, Self.Height - 60))
                Width: =630
                Y: =150
                ZIndex: =5

                Label11_13 As label:
                    Align: =Align.Center
                    FontWeight: =FontWeight.Semibold
                    OnSelect: =Select(Parent)
                    Text: =ThisItem.InventoryID
                    X: =35
                    Y: =9
                    ZIndex: =1

                Label11_10 As label:
                    Align: =Align.Center
                    FontWeight: =FontWeight.Semibold
                    OnSelect: =Select(Parent)
                    Text: =ThisItem.Quantity
                    X: =161
                    Y: =9
                    ZIndex: =2

                Label11_11 As label:
                    Align: =Align.Center
                    FontWeight: =FontWeight.Semibold
                    OnSelect: =Select(Parent)
                    Text: =LookUp(Inventories, ID = ThisItem.InventoryID).RetailPrice
                    X: =322
                    Y: =9
                    ZIndex: =3

                Label11_12 As label:
                    Align: =Align.Center
                    FontWeight: =FontWeight.Semibold
                    OnSelect: =Select(Parent)
                    Text: =Int(Label11_11.Text) * Int(Label11_10.Text)
                    X: =470
                    Y: =9
                    ZIndex: =4

            Label9_13 As label:
                Align: =Align.Center
                FontWeight: =FontWeight.Bold
                OnSelect: =Select(Parent)
                Text: ="Total"
                X: =480
                Y: =124
                ZIndex: =6

        Label2_147 As label:
            AutoHeight: =true
            Color: =RGBA(106, 108, 125, 1)
            FontWeight: =FontWeight.Bold
            Height: =50
            Size: =22
            Text: ="Order Summary"
            Visible: =!IsBlank(varNewSO)
            Width: =273.05
            X: =1088
            Y: =68
            ZIndex: =8

        Container6_40 As groupContainer.manualLayoutContainer:
            DropShadow: =DropShadow.None
            Fill: =RGBA(255, 255, 255, 1)
            Height: =762
            PaddingLeft: =15
            PaddingRight: =15
            Width: =990
            X: =40
            Y: =40
            ZIndex: =10

            Label2_136 As label:
                AutoHeight: =true
                FontWeight: =FontWeight.Bold
                Height: =50
                Size: =22
                Text: ="Payment Details"
                Width: =273.05
                X: =51
                Y: =69
                ZIndex: =8

            Label2_134 As label:
                AutoHeight: =true
                FontWeight: =FontWeight.Bold
                Height: =50
                Size: =17
                Text: ="Card is secure"
                Width: =273.05
                X: =716.95
                Y: =59
                ZIndex: =10

            Label2_139 As label:
                AutoHeight: =true
                Color: =RGBA(199, 199, 199, 1)
                FontWeight: =FontWeight.Semibold
                Height: =50
                Text: ="Your data is protected,"
                Width: =273.05
                X: =716.95
                Y: =96
                ZIndex: =11

            Label2_142 As label:
                AutoHeight: =true
                Color: =RGBA(199, 199, 199, 1)
                FontWeight: =FontWeight.Semibold
                Height: =50
                Text: ="everything will be private."
                Width: =273.05
                X: =716.95
                Y: =118
                ZIndex: =12

            Icon2_1 As icon.Lock:
                Color: =RGBA(0, 0, 0, 1)
                FocusedBorderThickness: =20
                Height: =35
                Icon: =Icon.Lock
                Width: =35
                X: =673
                Y: =74
                ZIndex: =13

            Image3_3 As image:
                Height: =168
                Image: ='Screenshot 2024-02-29 114213'
                RadiusBottomLeft: =10
                RadiusBottomRight: =10
                RadiusTopLeft: =10
                RadiusTopRight: =10
                Width: =279
                X: =51
                Y: =202
                ZIndex: =14

            Image3_4 As image:
                Height: =168
                Image: ='Screenshot 2024-02-29 114420'
                RadiusBottomLeft: =10
                RadiusBottomRight: =10
                RadiusTopLeft: =10
                RadiusTopRight: =10
                Width: =279
                X: =51
                Y: =381
                ZIndex: =15

            Image3_5 As image:
                Height: =168
                Image: ='Screenshot 2024-02-29 114213'
                RadiusBottomLeft: =10
                RadiusBottomRight: =10
                RadiusTopLeft: =10
                RadiusTopRight: =10
                Width: =279
                X: =51
                Y: =562
                ZIndex: =16

            Label2_143 As label:
                AutoHeight: =true
                Color: =RGBA(199, 199, 199, 1)
                Height: =50
                Text: ="Credit Card"
                Width: =273.05
                X: =400
                Y: =216
                ZIndex: =17

            TextInput3_3 As text:
                Default: =""
                Fill: =RGBA(250, 247, 255, 1)
                Format: =TextFormat.Number
                Height: =58
                PaddingLeft: =30
                RadiusBottomLeft: =10
                RadiusBottomRight: =10
                RadiusTopLeft: =10
                RadiusTopRight: =10
                Width: =540
                X: =400
                Y: =248
                ZIndex: =18

            Label2_144 As label:
                AutoHeight: =true
                Color: =RGBA(199, 199, 199, 1)
                Height: =50
                Text: ="Name"
                Width: =273.05
                X: =400
                Y: =360
                ZIndex: =19

            TextInput3_4 As text:
                Default: =""
                Fill: =RGBA(250, 247, 255, 1)
                Height: =58
                PaddingLeft: =30
                RadiusBottomLeft: =10
                RadiusBottomRight: =10
                RadiusTopLeft: =10
                RadiusTopRight: =10
                Width: =540
                X: =400
                Y: =392
                ZIndex: =20

            Label2_145 As label:
                AutoHeight: =true
                Color: =RGBA(199, 199, 199, 1)
                Height: =50
                Text: ="Exp Date"
                Width: =273.05
                X: =400
                Y: =527
                ZIndex: =21

            DatePicker1_1 As datepicker:
                Fill: =RGBA(250, 247, 255, 1)
                Height: =58
                PaddingLeft: =30
                Width: =228
                X: =400
                Y: =562
                ZIndex: =23

            Label2_146 As label:
                AutoHeight: =true
                Color: =RGBA(199, 199, 199, 1)
                Height: =50
                Text: ="CVV"
                Width: =273.05
                X: =708
                Y: =530
                ZIndex: =24

            TextInput3_5 As text:
                Default: =""
                Fill: =RGBA(250, 247, 255, 1)
                Height: =58
                PaddingLeft: =30
                RadiusBottomLeft: =10
                RadiusBottomRight: =10
                RadiusTopLeft: =10
                RadiusTopRight: =10
                Width: =228
                X: =708
                Y: =562
                ZIndex: =25

            Button5_18 As button:
                BorderThickness: =0
                DisplayMode: =If(IsBlank(TextInput3_3.Text) || IsBlank(TextInput3_4.Text) || IsBlank(TextInput3_5.Text) , DisplayMode.Disabled, DisplayMode.Edit)
                Fill: =RGBA(0, 0, 0, 1)
                Height: =44
                OnSelect: |-
                    =/*Patch(
                        SalesOrder,
                        LookUp(SalesOrder, ID = varNewSO.ID),
                        {Status: {Value: "Confirmed"}},
                        {PaymentStatus: {Value: "Paid"}} 
                    );*/
                    
                    // Assuming varNewSO is initialized elsewhere to hold the Sales Order creation result
                    Set(varNewSO, 
                        Patch(SalesOrder, Defaults(SalesOrder), {TotalPrice: Int(Label2_131.Text)}, {Status: {Value: "Confirmed"}},
                        {PaymentStatus: {Value: "Paid"}})
                    );
                    
                    // Create SalesOrderDetail items for each item in the Gallery6_7
                    ForAll(Gallery6_7.AllItems, 
                        Patch(SalesOrderDetail, Defaults(SalesOrderDetail), {
                            SalesOrderID: {
                                '@odata.type': "#Microsoft.Azure.Connectors.SharePoint.SPListExpandedReference",
                                Id: varNewSO.ID,
                                Value: varNewSO.Title
                            },
                            UnitPrice: Int(Label7_29.Text),
                            Quantity: Int(TextInput1_9.Text),
                            InventoryID: {
                                '@odata.type': "#Microsoft.Azure.Connectors.SharePoint.SPListExpandedReference",
                                Id: Int(Label13_1.Text),
                                Value: Label13_1.Text
                            }
                        })
                    );
                    
                    // Update inventory for each item in Gallery6_7
                    ForAll(
                        Gallery6_7.AllItems,
                        With(
                            {currentInventory: LookUp(Inventories, ID = Int(Label13_1.Text))},
                            Patch(
                                Inventories,
                                currentInventory,
                                {
                                    CostPrice: currentInventory.CostPrice - Int(TextInput1_9.Text)
                                }
                            )
                        )
                    );
                    
                    // Update Sales Order status to "Confirmed" and Payment status to "Paid"
                    /*Patch(
                        SalesOrder,
                        LookUp(SalesOrder, ID = varNewSO.ID),
                        {Status: {Value: "Confirmed"}, PaymentStatus: {Value: "Paid"}} 
                    );*/
                    Clear(SalesOrderItems);
                    // Navigate to the confirmation screen and clear the cart visibility context
                    Navigate(Screen5);
                    UpdateContext({cartVisible: false});
                RadiusBottomLeft: =15
                RadiusBottomRight: =15
                RadiusTopLeft: =15
                RadiusTopRight: =15
                Text: ="Confirm"
                Width: =227
                X: =708
                Y: =686
                ZIndex: =26

            Button5_17 As button:
                BorderThickness: =0
                Color: =RGBA(0, 0, 0, 1)
                Fill: =RGBA(244, 244, 244, 1)
                Height: =44
                HoverFill: =ColorFade(Self.Fill, -20%)
                OnSelect: |-
                    =
                    Navigate(Screen5);
                PressedFill: =Color.Purple
                RadiusBottomLeft: =15
                RadiusBottomRight: =15
                RadiusTopLeft: =15
                RadiusTopRight: =15
                Text: ="Cancel"
                Width: =227
                X: =400
                Y: =686
                ZIndex: =27

        Label2_148 As label:
            AutoHeight: =true
            Color: =RGBA(106, 108, 125, 1)
            FontWeight: =FontWeight.Bold
            Height: =50
            Size: =22
            Text: |-
                ="Total:"
            Visible: =!IsBlank(varNewSO)
            Width: =273.05
            X: =1128
            Y: =716
            ZIndex: =11

        Label2_149 As label:
            AutoHeight: =true
            Color: =RGBA(106, 108, 125, 1)
            FontWeight: =FontWeight.Bold
            Height: =48
            Size: =22
            Text: =Int(Label2_131.Text)
            Width: =165
            X: =1574
            Y: =716
            ZIndex: =12

        Button5_19 As button:
            BorderThickness: =0
            Fill: =RGBA(109, 49, 162, 1)
            Height: =44
            OnSelect: |
                =//Navigate(Screen5);
            RadiusBottomLeft: =15
            RadiusBottomRight: =15
            RadiusTopLeft: =15
            RadiusTopRight: =15
            Text: ="Add a Product"
            Visible: |-
                =//IsBlank(varNewSO)
                false
            Width: =227
            X: =1282
            Y: =384
            ZIndex: =13

        Button5_20 As button:
            BorderThickness: =0
            Fill: =RGBA(109, 49, 162, 1)
            Height: =44
            OnSelect: =Navigate(Screen5);
            RadiusBottomLeft: =15
            RadiusBottomRight: =15
            RadiusTopLeft: =15
            RadiusTopRight: =15
            Text: ="View Sale Orders"
            Visible: |-
                =//IsBlank(varNewSO)
                false
            Width: =227
            X: =1282
            Y: =456
            ZIndex: =14

    Container6_34 As groupContainer.manualLayoutContainer:
        DropShadow: =DropShadow.None
        Fill: =RGBA(250, 247, 255, 1)
        Height: =850
        PaddingLeft: =15
        PaddingRight: =15
        Width: =350
        X: =15
        Y: =150
        ZIndex: =2

        "Sidebar_9 As 'Admin Sidebar'":
            NavigateToOh: =Screen5_5
            NavigateToPo: =Screen5_1
            NavigateToProducts: =Screen5
            NavigateToSo: =Screen5_2
            ZIndex: =6

        "'Consumer Sidebar_7' As 'Consumer Sidebar'":
            NavigateToOh: =Screen5_5
            NavigateToProducts: =Screen5
            NavigateToSo: =Screen5_2
            Visible: =If(varRole = "Consumer", true, false)
            ZIndex: =7

        "'IM Sidebar_8' As 'IM Sidebar'":
            NavigateToOh: =Screen5_5
            NavigateToPo: =Screen5_1
            NavigateToProducts: =Screen5
            Visible: =If(varRole = "Inventory Manager1" || varRole = "Inventory Manager2", true, false)
            ZIndex: =8

    Container6_33 As groupContainer.manualLayoutContainer:
        DropShadow: =DropShadow.None
        Fill: =RGBA(250, 247, 255, 1)
        Height: =112
        PaddingLeft: =15
        PaddingRight: =15
        Width: =2120
        X: =15
        Y: =20
        ZIndex: =3

        Label3_16 As label:
            Align: =Align.Center
            BorderStyle: =BorderStyle.None
            Color: =RGBA(109, 49, 162, 1)
            Fill: =RGBA(250, 247, 255, 1)
            FontWeight: =FontWeight.Bold
            Height: =Parent.Height
            Italic: =true
            PaddingRight: =9.10
            PaddingTop: =9.10
            Size: =63.71
            Text: ="ims"
            Width: =228
            ZIndex: =1

        Label3_17 As label:
            Align: =Align.Center
            BorderStyle: =BorderStyle.None
            Color: =RGBA(109, 49, 162, 1)
            Fill: =RGBA(250, 247, 255, 1)
            FontWeight: =FontWeight.Bold
            Height: =112
            Italic: =true
            PaddingRight: =9.10
            Size: =63.71
            Text: ="Inventory Management System"
            Width: =1892
            X: =228
            ZIndex: =2

    Container6_36 As groupContainer.manualLayoutContainer:
        DropShadow: =DropShadow.None
        Fill: =RGBA(250, 247, 255, 1)
        Height: =850
        PaddingLeft: =15
        PaddingRight: =15
        RadiusBottomLeft: =10
        RadiusBottomRight: =10
        RadiusTopLeft: =10
        RadiusTopRight: =10
        Width: =370
        X: =15
        Y: =150
        ZIndex: =4

        Gallery8_7 As gallery.galleryVertical:
            '#CopilotOverlayLabel': ="Filtered"
            DelayItemLoading: =true
            Height: =740
            Items: =If(varRole = "Inventory Manager1" || varRole = "Inventory Manager2", Filter(SideBarGallery, Tab <> "Sale Orders"), If(varRole = "Consumer", Filter(SideBarGallery, Tab <> "Order Management"), SideBarGallery))
            Layout: =Layout.Vertical
            LoadingSpinner: =LoadingSpinner.Data
            TemplateSize: =66
            Width: =370
            Y: =95
            ZIndex: =2

            Button3_24 As button:
                BorderStyle: =BorderStyle.None
                Color: =RGBA(109, 49, 162, 1)
                Fill: =RGBA(255, 255, 255, 1)
                FontWeight: =FontWeight.Normal
                Height: =38
                HoverColor: =ColorFade(Self.Fill, -20%)
                HoverFill: =ColorFade(Self.Color, -20%)
                OnSelect: |-
                    =If(ThisItem.Tab = "Product Inventory", Navigate(Screen5));
                    If(ThisItem.Tab = "Products", Navigate(Screen5));
                    If(ThisItem.Tab = "Sale Orders", Navigate(Screen5_2));
                    If(ThisItem.Tab = "Cart", Navigate(Screen5_2));
                    If(ThisItem.Tab = "My Orders", Navigate(Screen5_5));
                    If(ThisItem.Tab = "Order Management", Navigate(Screen5_5));
                    If(ThisItem.Tab = "User Management", Navigate(Screen5_6));
                    If(ThisItem.Tab = "My Approvals", Navigate(Screen5_8));
                RadiusBottomLeft: =0
                RadiusBottomRight: =0
                RadiusTopLeft: =0
                RadiusTopRight: =0
                Size: =18.21
                Text: =ThisItem.Tab
                Width: =359
                X: =0.00
                Y: =9
                ZIndex: =3

    Label12_10 As label:
        Color: =RGBA(109, 49, 162, 1)
        FontWeight: =FontWeight.Bold
        Height: =48
        Size: =17
        Text: =LookUp(Roles, Person.Email = User().Email).Title
        Width: =254
        X: =1866
        Y: =35
        ZIndex: =5

    Label12_11 As label:
        Color: =RGBA(109, 49, 162, 1)
        FontWeight: =FontWeight.Bold
        Height: =48
        Size: =17
        Text: =LookUp(Roles, Person.Email = User().Email).Role.Value
        Width: =254
        X: =1866
        Y: =68
        ZIndex: =6

